<!DOCTYPE html>
<html>
<head>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      overflow: hidden;
    }
    
    #titlebar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 32px;
      background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 12px;
      -webkit-app-region: drag;
      z-index: 999999;
      border-bottom: 1px solid #5865F2;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.5);
    }
    
    #titlebar-title {
      color: #94a3b8;
      font-size: 11px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    #app-icon {
      width: 20px;
      height: 20px;
      filter: drop-shadow(0 0 4px rgba(88, 101, 242, 0.6));
    }
    
    #app-name {
      font-weight: 600;
      font-size: 13px;
      color: #e2e8f0;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
      letter-spacing: 0.3px;
    }
    
    #titlebar-controls {
      display: flex;
      -webkit-app-region: no-drag;
    }
    
    .titlebar-button {
      width: 40px;
      height: 32px;
      border: none;
      background: transparent;
      color: #94a3b8;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      font-size: 12px;
    }
    
    .titlebar-button:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .titlebar-button.close:hover {
      background: #ef4444;
      color: white;
    }
    
    #check-updates:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(88, 101, 242, 0.6);
    }
    
    #app-content {
      margin-top: 32px;
      height: calc(100vh - 32px);
      width: 100vw;
    }
    
    #app-frame {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    #update-notification {
      position: fixed;
      top: 32px;
      right: 10px;
      background: #1e293b;
      border: 2px solid #5865F2;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
      z-index: 999998;
      min-width: 320px;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    #update-content {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    #update-icon {
      font-size: 32px;
      animation: rotate 2s linear infinite;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    #update-text {
      flex: 1;
    }
    
    #update-title {
      color: white;
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }
    
    #update-message {
      color: #94a3b8;
      font-size: 12px;
      font-weight: 400;
    }
    
    #update-actions {
      display: flex;
      gap: 8px;
    }
    
    .update-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .update-btn.primary {
      background: #5865F2;
      color: white;
      font-weight: 600;
    }
    
    .update-btn.primary:hover {
      background: #4752c4;
    }
    
    .update-btn:not(.primary) {
      background: #2d3748;
      color: #cbd5e0;
      border: 1px solid #4a5568;
    }
    
    .update-btn:not(.primary):hover {
      background: #374151;
    }
  </style>
</head>
<body>
  <div id="titlebar">
    <div id="titlebar-title">
      <img id="app-icon" src="icon.png" alt="Collabrix">
      <span id="app-name">Collabrix</span>
    </div>
    <div id="titlebar-controls">
      <button class="titlebar-button" id="minimize" title="Minimize">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
          <rect x="0" y="5" width="12" height="2"/>
        </svg>
      </button>
      <button class="titlebar-button" id="maximize" title="Maximize">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1">
          <rect x="1" y="1" width="10" height="10"/>
        </svg>
      </button>
      <button class="titlebar-button close" id="close" title="Close">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M1 1 L11 11 M11 1 L1 11"/>
        </svg>
      </button>
    </div>
  </div>
  
  <div id="app-content">
    <iframe id="app-frame" src="https://collabrixs.vercel.app"></iframe>
  </div>
  
  <!-- Update notification -->
  <div id="update-notification" style="display: none;">
    <div id="update-content">
      <div id="update-icon">üîÑ</div>
      <div id="update-text">
        <div id="update-title">Update Available</div>
        <div id="update-message">A new version of Collabrix is available</div>
      </div>
      <div id="update-actions">
        <button id="update-download" class="update-btn primary">Download</button>
        <button id="update-dismiss" class="update-btn">Later</button>
      </div>
    </div>
  </div>
  
  <script>
    // Auto-check for updates on startup
    setTimeout(() => {
      console.log('üöÄ Auto-checking for updates...');
      console.log('üìç GitHub Repo: JuusoJuusto/Collabrix');
      window.electronAPI.checkForUpdates();
    }, 3000);
    
    document.getElementById('minimize').addEventListener('click', () => {
      window.electronAPI.minimizeWindow();
    });
    
    document.getElementById('maximize').addEventListener('click', () => {
      window.electronAPI.maximizeWindow();
    });
    
    document.getElementById('close').addEventListener('click', () => {
      window.electronAPI.closeWindow();
    });
    
    // Update notification handlers
    let updateInfo = null;
    
    document.getElementById('update-download').addEventListener('click', () => {
      document.getElementById('update-message').textContent = 'Downloading update...';
      document.getElementById('update-download').disabled = true;
      window.electronAPI.downloadUpdate();
    });
    
    document.getElementById('update-dismiss').addEventListener('click', () => {
      document.getElementById('update-notification').style.display = 'none';
    });
    
    // Listen for update events from main process
    if (window.electronAPI && window.electronAPI.onUpdateAvailable) {
      window.electronAPI.onUpdateAvailable((info) => {
        console.log('üéâ UPDATE NOTIFICATION RECEIVED:', info);
        updateInfo = info;
        document.getElementById('update-message').textContent = `Version ${info.version} is available`;
        document.getElementById('update-notification').style.display = 'block';
      });
      
      window.electronAPI.onUpdateDownloadProgress((progress) => {
        document.getElementById('update-message').textContent = `Downloading... ${Math.round(progress.percent)}%`;
      });
      
      window.electronAPI.onUpdateDownloaded((info) => {
        document.getElementById('update-icon').textContent = '‚úÖ';
        document.getElementById('update-icon').style.animation = 'none';
        document.getElementById('update-title').textContent = 'Update Ready!';
        document.getElementById('update-message').textContent = 'Restart to install v' + info.version;
        document.getElementById('update-download').textContent = 'üöÄ Restart Now';
        document.getElementById('update-download').disabled = false;
        document.getElementById('update-download').onclick = () => {
          window.electronAPI.installUpdate();
        };
      });
    } else {
      console.error('‚ùå electronAPI not available for updates');
    }
  </script>
</body>
</html>
